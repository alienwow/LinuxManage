#passport
upstream passport{
    server 10.99.187.201:7073;
}
#接口服务器
upstream srv{
    server 10.99.187.201:7074;
}
#会员管理
upstream member{
    ip_hash;
    server 10.99.187.201:7071;
}
#后台管理
upstream shopadmin{
    ip_hash;
    server 10.99.187.201:7072;
}
#聊天服务
upstream chatserver{
    ip_hash;
    server 10.99.187.201:7075;
}
#客服服务
upstream customerServices{
    ip_hash;
    server 10.99.187.201:7076;
}
#fastdfs_storage服务器
upstream fdfs_g1{
    server 10.99.187.106:7005;
}

#商城主站点
server
{
    server_name www.pxmimi.com;
    listen 80;
    charset utf8;
    index index.html index.htm;
    error_page      404 500 502 503 504  /error.html;
    access_log off;
    #access_log /data/nginx/logs/shop.log;
    location = /50x.html {
        #internal;
        root /home/wwwroot/pc;
    }
    location ~* \*.(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|pdf|xls|mp3|wma)$ {
        if (-f $request_filename) {
            root /home/wwwroot/pc/;
            expires 10d;
            break;
        }
    }
    location ~* \*.(js|css)?$ {
        if (-f $request_filename) {
            root /home/wwwroot/pc/;
            expires 1h;
            break;
        }
    }
    #聊天服务配置
    location /service {
        proxy_redirect off;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_pass http://chatserver/;
        
        #websocket 配置开始
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        #websocket 配置结束
        
    }
    #接口站点配置
    location /srv {
        proxy_redirect off;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_pass http://srv/;
    }
    #设定查看Nginx状态的地址
    location /nginxstatus {
        stub_status on;
        access_log off;
        #auth_basic "nginxstatus";
        #auth_basic_user_file conf/htpasswd;
        #htpasswd文件的内容可以用apache提供的htpasswd工具来产生。
        #访问IP
        #allow 10.162.63.73;
        #deny all;
    }
    location / {
        proxy_redirect off;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        root /home/wwwroot/pc;
    }
}

#shopadmin 商城后台管理站点
server
{
    server_name shopadmin.pxmimi.com;
    listen 80;
    charset utf8;
    index index.html index.htm;
    error_page      404 500 502 503 504  /50x.html;
    access_log off;
    #access_log /data/nginx/logs/shopadmin.log;
    location = /50x.html {
        internal;
        root html;
    }
    location ~* \*.(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|pdf|xls|mp3|wma)$ {
        proxy_redirect off;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        if (-f $request_filename) {
            proxy_pass http://shopadmin/;
            expires 10d;
            break;
        }
    }
    location ~* \*.(js|css)?$ {
        proxy_redirect off;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        if (-f $request_filename) {
            proxy_pass http://shopadmin/;
            expires 1h;
            break;
        }
    }
    location / {
        proxy_redirect off;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_pass http://shopadmin/;
    }
}


#member 会员管理站点
server
{
    server_name member.pxmimi.com;
    listen 80;
    charset utf8;
    index index.html index.htm;
    error_page      404 500 502 503 504  /50x.html;
    access_log off;
    #access_log /data/nginx/logs/member.log;
    location = /50x.html {
        internal;
        root html;
    }
    location ~* \*.(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|pdf|xls|mp3|wma)$ {
        proxy_redirect off;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        if (-f $request_filename) {
            proxy_pass http://member/;
            expires 10d;
            break;
        }
    }
    location ~* \*.(js|css)?$ {
        proxy_redirect off;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        if (-f $request_filename) {
            proxy_pass http://member/;
            expires 1h;
            break;
        }
    }
    location / {
        proxy_redirect off;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_pass http://member/;
    }
}

#用户登入passport
server
{
    server_name passport.pxmimi.com;
    listen 80;
    charset utf8;
    index index.html index.htm;
    error_page      404 500 502 503 504  /50x.html;
    access_log off;
    #access_log /data/nginx/logs/tfs.log;
    location = /50x.html {
        internal;
        root html;
    }
    location ~* \*.(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|pdf|xls|mp3|wma)$ {
        proxy_redirect off;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        if (-f $request_filename) {
            proxy_pass http://passport/;
            expires 10d;
            break;
        }
    }
    location ~* \*.(js|css)?$ {
        proxy_redirect off;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        if (-f $request_filename) {
            proxy_pass http://passport/;
            expires 1h;
            break;
        }
    }
    location / {
        proxy_redirect off;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_pass http://passport/;
    }
}

#图片站点
server
{
    server_name pic.pxmimi.com;
    listen 80;
    charset utf8;
    index index.html index.htm;
    error_page      404 500 502 503 504  /50x.html;
    access_log off;
    #access_log /data/nginx/logs/tfs.log;
    location = /50x.html {
        internal;
        root html;
    }
    location /g1/M00 {
        proxy_redirect off;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_pass http://fdfs_g1;
    }
}